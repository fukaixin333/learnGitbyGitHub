<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.citic.server.gf.mapper.ControlTaskMapper1A">
    <select id="queryControlTaskInfo" parameterType="String" resultType="com.citic.server.gf.domain.response.ControlResponse_Kzqq">
        SELECT * FROM BR31_KZQQ WHERE bdhm = #{bdhm}
    </select>

    <select id="queryControlTaskDetail" parameterType="String" resultType="com.citic.server.gf.domain.response.ControlResponse_Kzzh">
        SELECT a.*, b.xm, b.zjlx, b.dsrzjhm, b.fymc, b.cbr, b.gzzbh, b.gwzbh, b.ah, b.ckh
        FROM BR31_KZZH a
        LEFT JOIN BR31_KZQQ b ON
        a.bdhm = b.bdhm
        WHERE a.bdhm = #{bdhm} AND a.ccxh = #{ccxh}
    </select>
    <select id="queryTaskResultListByBdhm" parameterType="String" resultType="com.citic.server.gf.domain.request.ControlRequest_Kzxx">
        SELECT a.*,b.ye,b.kyye,b.djxe,b.skje,b.skse,b.kzzt,b.wnkzyy,b.csksrq,b.csjsrq,b.ceskje FROM BR31_KZZH a, BR31_KZCL_INFO b WHERE a.BDHM=b.BDHM AND a.BDHM = #{bdhm}
    </select>

    <select id="queryOriginalTaskResult" parameterType="String" resultType="com.citic.server.gf.domain.request.ControlRequest_Kzxx">
        SELECT * FROM BR31_KZCL_INFO WHERE bdhm = #{bdhm} AND khzh = #{khzh}
        <choose>
            <when test="glzhhm != null and glzhhm != ''">
                AND glzhhm = #{glzhhm}
            </when>
            <otherwise>
                AND (glzhhm is null OR glzhhm = '')
            </otherwise>
        </choose>
    </select>

    <select id="queryTodoTaskCount" parameterType="String" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM BR31_KZCL_INFO WHERE BDHM = #{bdhm} AND STATUS_CD IN('0', '1', '2', 'N', 'H', 'F', 'S', 'R')
    </select>

    <select id="queryTaskResultDjxxList" parameterType="String" resultType="com.citic.server.gf.domain.request.ControlRequest_Djxx">
        SELECT * FROM BR31_ZXDJ_INFO WHERE bdhm = #{bdhm} AND ccxh = #{ccxh}
    </select>

    <select id="queryTaskResultQlxxList" parameterType="String" resultType="com.citic.server.gf.domain.request.ControlRequest_Qlxx">
        SELECT * FROM BR31_YXQ_INFO WHERE bdhm = #{bdhm} AND ccxh = #{ccxh}
    </select>

    <select id="queryLegalDocumentInfo" parameterType="String" resultType="com.citic.server.gf.domain.MC20_WS">
        SELECT * FROM BR31_WS WHERE bdhm = #{bdhm} ORDER BY xh
    </select>

    <update id="updateControlTaskResult" parameterType="com.citic.server.gf.domain.request.ControlRequest_Kzxx">
        UPDATE BR31_KZCL_INFO
        <set>
            <if test="ye != null and ye != '' ">
                YE = #{ye},
            </if>
            <if test="kyye != null and kyye != '' ">
                KYYE = #{kyye},
            </if>
            <if test="csksrq != null and csksrq != '' ">
                CSKSRQ = #{csksrq},
            </if>
            <if test="csjsrq != null and csjsrq != '' ">
                CSJSRQ = #{csjsrq},
            </if>
            <if test="djxe != null and djxe != '' ">
                DJXE = #{djxe},
            </if>
            <if test="skje != null and skje != '' ">
                SKJE = #{skje},
            </if>
            <if test="ceskje != null and ceskje != '' ">
                CESKJE = #{ceskje},
            </if>
            <if test="wnkzyy != null and wnkzyy != '' ">
                WNKZYY = #{wnkzyy},
            </if>
            <if test="kzzt != null and kzzt != '' ">
                KZZT = #{kzzt},
            </if>
            <if test="beiz != null and beiz != ''">
                beiz = #{beiz}
            </if>
            <if test="status_cd != null  and status_cd != '' ">
                STATUS_CD = #{status_cd},
            </if>
            <if test="hxappid != null and hxappid != '' ">
                HXAPPID = #{hxappid},
            </if>
            <if test="lcappid != null and lcappid != '' ">
                LCAPPID = #{lcappid},
            </if>
        </set>
        WHERE BDHM = #{bdhm} AND CCXH = #{ccxh}
    </update>

    <update id="updateControlTaskInfo" parameterType="com.citic.server.gf.domain.request.ControlRequest_Kzxx">
        UPDATE BR31_KZZH
        <set>
            <if test="zhlx != null and zhlx != ''">
                zhlx = #{zhlx},
            </if>
            <if test="status != null and status != ''">
                status = #{status},
            </if>
            <if test="jjyy != null and jjyy != ''">
                jjyy = #{jjyy},
            </if>
            <if test="khhfhh !=null and khhfhh !=''">
                khhfhh=#{khhfhh},
            </if>
            <if test="khhsh !=null and khhsh !=''">
                 khhsh=#{khhsh}
            </if>
        </set>
        WHERE bdhm = #{bdhm} and ccxh = #{ccxh}
    </update>

    <update id="updateControlRequestStatus" parameterType="String">
        UPDATE BR31_KZQQ SET STATUS = #{status} WHERE BDHM = #{bdhm}
    </update>

    <insert id="insertControlTaskQlxx" parameterType="com.citic.server.gf.domain.request.QueryRequest_Qlxx">
        INSERT INTO BR31_YXQ_INFO (BDHM, CCXH, XH, JRCPBH, KHZH, GLZHHM, KHWDDM, YXSCQLX, QLLX, QLR, QLJE, QLRDZ, QLRLXFS)
        VALUES ( #{bdhm, jdbcType=VARCHAR}, #{ccxh, jdbcType=VARCHAR}, #{xh, jdbcType=VARCHAR}, #{jrcpbh, jdbcType=VARCHAR},
        #{khzh, jdbcType=VARCHAR}, #{glzhhm, jdbcType=VARCHAR}, #{khwddm, jdbcType=VARCHAR}, #{yxscqlx,
        jdbcType=VARCHAR},
        #{qllx, jdbcType=VARCHAR}, #{qlr, jdbcType=VARCHAR}, #{qlje, jdbcType=VARCHAR}, #{qlrdz, jdbcType=VARCHAR},
        #{qlrlxfs, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertControlTaskDjxx" parameterType="com.citic.server.gf.domain.request.QueryRequest_Djxx">
        INSERT INTO BR31_ZXDJ_INFO (BDHM,CCXH,CSXH,JRCPBH,KHZH,GLZHHM,KHWDDM,DJJG,DJWH,DJJE,DJJZRQ,BEIZ,QRYDT)
        VALUES (#{bdhm, jdbcType=VARCHAR}, #{ccxh, jdbcType=VARCHAR}, #{csxh, jdbcType=VARCHAR}, #{jrcpbh, jdbcType=VARCHAR},
        #{khzh, jdbcType=VARCHAR}, #{glzhhm, jdbcType=VARCHAR}, #{khwddm, jdbcType=VARCHAR}, #{djjg, jdbcType=VARCHAR},
        #{djwh,
        jdbcType=VARCHAR}, #{djje, jdbcType=VARCHAR}, #{djjzrq, jdbcType=VARCHAR}, #{beiz, jdbcType=VARCHAR},
        #{qrydt, jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertShfeedMessage" parameterType="com.citic.server.gf.domain.Br32_msg">
        INSERT INTO br32_msg (msgkey, bdhm, msg_type_cd, packetkey, organkey_r, senddate, msg_filename, msg_filepath, status_cd, create_dt, qrydt)
        VALUES (#{msgkey}, #{bdhm}, #{msg_type_cd}, #{packetkey}, #{organkey_r}, #{senddate}, #{msg_filename}, #{msg_filepath}, #{status_cd}, #{create_dt}, #{qrydt})
    </insert>

    <insert id="insertShfeedResult" parameterType="com.citic.server.gf.domain.Result_Jg">
        INSERT INTO BR32_JG(BDHM, CODE, MSG, QRYDT) VALUES (#{bdhm}, #{result}, #{msg}, #{qrydt})
    </insert>

    <insert id="insertFallbackDocument" parameterType="com.citic.server.gf.domain.request.ControlRequest_Hzxx">
    <![CDATA[
    	INSERT INTO BR31_KZQQ_HZWS(bdhm, xh, kzlx, kzcs, wjmc, wjlx, wjpath, md5, qrydt)
    	VALUES (#{bdhm}, #{xh, jdbcType=VARCHAR}, #{kzlx, jdbcType=VARCHAR}, #{kzcs, jdbcType=VARCHAR}, #{wjmc}, #{wjlx}, #{wjpath}, #{md5}, #{qrydt})
    ]]>
    </insert>

    <delete id="clearAllQlxxInfo" parameterType="String">
        DELETE FROM BR31_YXQ_INFO WHERE bdhm = #{bdhm} AND ccxh = #{ccxh}
    </delete>

    <delete id="clearAllDjxxInfo" parameterType="String">
        DELETE FROM BR31_ZXDJ_INFO WHERE bdhm = #{bdhm} AND ccxh = #{ccxh}
    </delete>

    <delete id="clearShfeedMessage" parameterType="String">
        DELETE FROM BR32_MSG WHERE bdhm = #{bdhm}
    </delete>

    <delete id="clearShfeedResult" parameterType="String">
        DELETE FROM BR32_JG WHERE bdhm = #{bdhm}
    </delete>

    <delete id="clearFallbackDocument" parameterType="String">
        DELETE FROM BR31_KZQQ_HZWS WHERE bdhm = #{bdhm}
    </delete>

    <select id="getNextSequence" parameterType="String" resultType="String">
        ${_parameter}
    </select>

    <select id="queryOriginalCount" parameterType="String" resultType="String">
    	SELECT a.bdhm from br31_kzzh a, br31_kzcl_info b
		WHERE a.bdhm = b.bdhm AND a.ydjdh = #{ydjdh} AND a.kzcs = #{kzcs} 
		AND (a.status is null OR a.status = '' OR a.status IN ('N', 'H', 'F'))
    </select>

    <update id="updateMC21TaskFact2" parameterType="java.util.List">
        update Mc21_task_fact2 set SERVERID ='' where bdhm in
        <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>

    <delete id="deleteMc21Task2Status" parameterType="java.util.List">
        delete from MC21_TASK2_STATUS where taskKey in (select taskKey from mc21_task_fact2 where taskType='1' and bdhm in
        <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
        )
    </delete>
    <update id="updateUnfreezeStatus" parameterType="String">
        update br31_kzzh set status = 'H' where bdhm = #{bdhm}
    </update>
</mapper>