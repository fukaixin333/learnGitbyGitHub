<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.citic.server.net.mapper.MM30_xzcsMapper">

    <delete id="delBr30_xzcs" parameterType="string">
		<![CDATA[ delete from br30_xzcs  where bdhm=#{bdhm} ]]>
    </delete>

    <delete id="delBr30_Ws" parameterType="string">
		<![CDATA[ delete from br30_ws  where  wsbh =#{_parameter} ]]>
    </delete>

    <delete id="delBr30_Gzz" parameterType="string">
		<![CDATA[ delete from br30_gzz  where gzzbm in (select gzzbh from br30_xzcs where  bdhm=#{bdhm} )  or gwzbm in (select gwzbh from br30_xzcs where  bdhm=#{bdhm} )]]>
    </delete>

    <insert id="insertBr30_xzcs" parameterType="com.citic.server.gf.domain.response.QueryResponse_Cxqq">
        insert into
        br30_xzcs(bdhm,lb,xz,xm,zjlx,dsrzjhm,fymc,fydm,cbr,yhdh,ah,gzzbh,gwzbh,ckh,ckkssj,ckjssj,wsbh,status,orgkey,msg_type_cd,packetkey,qrydt,msgcheckresult,recipient_time)
        values(
        #{bdhm},#{lb},#{xz},#{xm},#{zjlx},#{dsrzjhm},#{fymc},#{fydm},#{cbr},#{yhdh},#{ah},#{gzzbh},#{gwzbh},#{ckh},#{ckkssj},#{ckjssj},#{wsbh},#{status},#{orgkey},#{msg_type_cd},#{packetkey},
        #{qrydt},#{msgcheckresult},#{recipient_time}
        )
    </insert>

    <insert id="insertBr30_ws" parameterType="String">
        insert into br30_ws(
        wsbh,xh,wjmc,wjlx,wslb,md5,wspath
        )
        select distinct
        wsbh,xh,wjmc,wjlx,wslb,md5,wspath
        from mc20_ws where wsbh=#{wsbh}
    </insert>

    <insert id="insertBr30_gzz" parameterType="com.citic.server.gf.domain.response.QueryResponse_Cxqq">
        insert into br30_gzz(xh, zjmc, gzzbm, gzzwjgs, gzzpath, gwzbm, gwzwjgs, gwzpath)
        select distinct
        xh, zjmc, gzzbm, gzzwjgs, gzzpath, gwzbm, gwzwjgs, gwzpath
        from mc20_gzz where  (gzzbm=#{gzzbh} or gwzbm=#{gwzbh})
    </insert>

    <select id="getBr30_xzcsVo" parameterType="string" resultType="com.citic.server.gf.domain.response.QueryResponse_Cxqq">
        select * from br30_xzcs where bdhm=#{bdhm}
    </select>

    <select id="getBr30_xzcs_infoList" parameterType="string" resultType="com.citic.server.gf.domain.request.QueryRequest_Zhxx">
        select * from br30_xzcs_info where bdhm=#{bdhm} order by ccxh
    </select>

    <select id="getBr30_xzcs_info_zcList" parameterType="com.citic.server.gf.domain.request.QueryRequest_Zhxx" resultType="com.citic.server.gf.domain.request.QueryRequest_Jrxx">
        select * from
        br30_xzcs_info_zc where bdhm=#{bdhm} and ccxh=#{ccxh}
    </select>

    <select id="getBr30_xzcs_info_csList" parameterType="com.citic.server.gf.domain.request.QueryRequest_Zhxx" resultType="com.citic.server.gf.domain.request.QueryRequest_Djxx">
        select * from
        br30_xzcs_info_cs where bdhm=#{bdhm} and ccxh=#{ccxh}
    </select>

    <select id="getBr30_xzcs_info_wlList" parameterType="com.citic.server.gf.domain.request.QueryRequest_Zhxx" resultType="com.citic.server.gf.domain.request.QueryRequest_Wlxx">
        select * from
        br30_xzcs_info_wl where bdhm=#{bdhm} and ccxh=#{ccxh}
    </select>

    <select id="getBr30_xzcs_info_qlList" parameterType="com.citic.server.gf.domain.request.QueryRequest_Zhxx" resultType="com.citic.server.gf.domain.request.QueryRequest_Qlxx">
        select * from
        br30_xzcs_info_ql where bdhm=#{bdhm} and ccxh=#{ccxh}
    </select>

    <select id="getBr30_xzcs_info_glxxList" parameterType="com.citic.server.gf.domain.request.QueryRequest_Zhxx" resultType="com.citic.server.gf.domain.request.QueryRequest_Glxx">
        select * from
        br30_xzcs_info_glxx where bdhm=#{bdhm} and ccxh=#{ccxh}
    </select>

    <select id="getParty_Id" parameterType="com.citic.server.gf.domain.response.QueryResponse_Cxqq" resultType="com.citic.server.gf.domain.response.QueryResponse_Cxqq">
        select party_id from bb11_party
        <where>
            <if test="dsrzjhm != null  and dsrzjhm != '' ">
                and ctid = #{dsrzjhm}
            </if>
        </where>
    </select>

    <select id="getZhxxList" parameterType="string" resultType="com.citic.server.gf.domain.request.QueryRequest_Zhxx">
        select acct_num as khzh ,acct_type as cclb,status_cd as zhzt,organkey_pboc as
        khwddm,oatm as khrq,catm as xhrq,curr_cd as bz,last_amtval as ye,amtval as
        kyye
        from bb11_id_deposit
        where party_id = #{value}
        union
        select
        acct_num as khzh ,acct_type as cclb,status_cd as zhzt,organkey_pboc as khwddm,oatm as khrq,catm as xhrq,curr_cd as bz,last_amtval as ye,amtval
        as
        kyye
        from bb11_deposit_c
        where party_id = #{value}
    </select>

    <insert id="insertBr30_xzcs_info" parameterType="com.citic.server.gf.domain.request.QueryRequest_Zhxx">
        insert into br30_xzcs_info(
        bdhm,ccxh,khzh,cclb,zhzt,khwd,khwddm,khrq,xhrq,bz,ye,kyye,glzjzh,txdz,yzbm,lxdh,beiz,qrydt,orgkey,fksj
        ) values
        (#{bdhm,jdbcType=VARCHAR},#{ccxh,jdbcType=VARCHAR},#{khzh,jdbcType=VARCHAR},#{cclb,jdbcType=VARCHAR},#{zhzt,jdbcType=VARCHAR},
        #{khwd,jdbcType=VARCHAR},#{khwddm,jdbcType=VARCHAR},#{khrq,jdbcType=VARCHAR},#{xhrq,jdbcType=VARCHAR},
        #{bz,jdbcType=VARCHAR},#{ye,jdbcType=VARCHAR},#{kyye,jdbcType=VARCHAR},#{glzjzh,jdbcType=VARCHAR},#{txdz,jdbcType=VARCHAR},#{yzbm,jdbcType=VARCHAR},
        #{lxdh,jdbcType=VARCHAR},#{beiz,jdbcType=VARCHAR},#{qrydt},#{orgkey},#{fksj})
    </insert>

    <update id="updateBr30_xzcs" parameterType="com.citic.server.gf.domain.response.QueryResponse_Cxqq">
        update Br30_xzcs
        <set>
            <if test="status != null">
                status=#{status}
            </if>

        </set>
        where bdhm=#{bdhm}
    </update>

    <insert id="insertBr30_xzcs_info_zc" parameterType="String">
        insert into br30_xzcs_info_zc(
        bdhm,ccxh,khzh,zcxh,zcmc,zclx,zcglr,zckfjy,zcjyxz,xzxcrq,jldw,bz,zcdwjg,se,kyse,beiz,khwddm
        )
        select t1.bdhm,t1.ccxh,t1.khzh,rownum
        ,t2.zcmc,t2.zclx,t2.zcglr,t2.zckfjy,t2.zcjyxz,t2.xzxcrq,t2.jldw,t2.bz,t2.zcdwjg,t2.se,t2.kyse,t2.beiz,t2.khwddm
        from br30_xzcs_info
        t1,bb11_xzcs_info_zc t2
        where t1.khzh = t2.acct_num
        and t1.bdhm=#{bdhm}
    </insert>

    <insert id="insertBr30_xzcs_info_cs" parameterType="String">
        insert into br30_xzcs_info_cs
        (bdhm, ccxh, csxh, djjzrq, djjg, djwh, djje, beiz, qrydt)
        select t1.bdhm,t1.ccxh,rownum,t2.freezeenddate,t2.freezedeptname,'',t2.freezebalance,t2.remark,t1.qrydt
        from br30_xzcs_info t1,bb11_freeze t2
        where t1.khzh = t2.acct_num
        and t1.bdhm=#{bdhm}
    </insert>

    <insert id="insertBr30_xzcs_info_ql" parameterType="String">
        insert into br30_xzcs_info_ql
        (bdhm, ccxh, xh, qllx, qlr, qlje, qlrdz, qlrlxfs, khzh,
        khwddm, qrydt)
        select
        t1.bdhm,t1.ccxh,rownum,t2.rightstype,t2.obligeename,t2.rightsbalance,t2.obligeeaddress,t2.obligeecontactinfo,t1.khzh,t1.khwddm,t1.qrydt
        from
        br30_xzcs_info t1,bb11_right t2
        where t1.khzh = t2.acct_num
        and t1.bdhm=#{bdhm}
    </insert>

    <insert id="insertBr30_xzcs_info_glxx" parameterType="String">
        insert into br30_xzcs_info_glxx
        (bdhm, ccxh, glxh, zkhzh, glzhlb, glzhhm, bz, ye, kyye,
        beiz, organkey, qrydt)
        select
        t1.bdhm,t1.ccxh,rownum,t2.ctac,t2.type_cd,t2.acct_num,t2.curr_cd,t2.last_amtval,t2.amtval,t2.remark,t2.organkey,t1.qrydt
        from br30_xzcs_info
        t1,bb11_id_deposit t2
        where t1.khzh = t2.acct_num
        and t1.bdhm=#{bdhm}
        union
        select
        t1.bdhm,t1.ccxh,rownum,t2.ctac,t2.type_cd,t2.acct_num,t2.curr_cd,t2.last_amtval,t2.amtval,t2.remark,t2.organkey,t1.qrydt
        from br30_xzcs_info
        t1,bb11_deposit_c t2
        where t1.khzh = t2.acct_num
        and t1.bdhm=#{bdhm}
    </insert>

    <insert id="insertBr30_xzcs_info_wl" parameterType="com.citic.server.gf.domain.response.QueryResponse_Cxqq">
        insert into br30_xzcs_info_wl
        (bdhm, ccxh, wlxh, jyzl, zjlx,bz, je, jysj, jylsh, zckzxm,zckzh, zckzhkhh, jydsyhhh, jydszjlx, jydszjhm,jydstxdz,
        jydsyzbm, jydslxdh, beiz, khzh,organkey,
        qrydt)
        select
        t1.bdhm,t1.ccxh,rownum,t2.tx_type_cd,t2.debit_credit,t2.crtp,t2.crat,t2.dt_time,t2.tx_no,t2.tcnm,t2.tcac,t2.cfin,t2.cfic,t2.tcit,t2.tcid,t2.jydstxdz,t2.jydsyzbm,t2.jydslxdh,t2.temp1,t1.khzh,t2.organkey,t1.qrydt
        from br30_xzcs_info t1,bb11_trans t2
        where t1.khzh = t2.acct_num
        and t1.bdhm=#{bdhm}
        <if test="ckkssj  !=null  and ckkssj != '' ">
            and <![CDATA[ t2.dt_time  >=  #{ckkssj} ]]>
        </if>
        <if test="ckjssj !=null  and ckjssj != '' ">
            and <![CDATA[ t2.dt_time  <=  #{ckjssj} ]]>
        </if>
    </insert>

    <insert id="insertBr32_msg" parameterType="com.citic.server.gf.domain.Br32_msg">
        insert into br32_msg (msgkey, bdhm, msg_type_cd, packetkey, organkey_r, senddate, msg_filename,
        msg_filepath, status_cd, create_dt,qrydt)
        values (#{msgkey}, #{bdhm}, #{msg_type_cd}, #{packetkey}, #{organkey_r}, #{senddate},
        #{msg_filename}, #{msg_filepath}, #{status_cd}, #{create_dt},
        #{qrydt})
    </insert>

    <select id="isPacketCount" parameterType="string" resultType="java.lang.Integer">
        select count(1) from BR30_XZCS where packetkey =#{packetkey} and status not in
        ('6','7')
    </select>

    <insert id="insertBr30_xzcs_info_zc_hx" parameterType="com.citic.server.gf.domain.request.QueryRequest_Jrxx">
        <!-- insert into br30_xzcs_info_zc (bdhm, ccxh, khzh, zcxh, zcmc, zclx, zcglr, zckfjy, zcjyxz, xzxcrq, jldw, bz, beiz, khwddm, qrydt,zcdwjg,se,kyse) 
            values (#{bdhm,jdbcType=VARCHAR}, #{ccxh,jdbcType=VARCHAR}, #{khzh,jdbcType=VARCHAR}, #{zcxh,jdbcType=VARCHAR}, #{zcmc,jdbcType=VARCHAR}, #{zclx,jdbcType=VARCHAR}, 
            #{zcglr,jdbcType=VARCHAR}, #{zckfjy,jdbcType=VARCHAR}, #{zcjyxz,jdbcType=VARCHAR}, #{xzxcrq,jdbcType=VARCHAR}, #{jldw,jdbcType=VARCHAR}, #{bz,jdbcType=VARCHAR}, 
            #{beiz,jdbcType=VARCHAR}, #{khwddm,jdbcType=VARCHAR}, #{qrydt,jdbcType=VARCHAR}, #{zcdwjg,jdbcType=VARCHAR}, #{se,jdbcType=VARCHAR}, #{kyse,jdbcType=VARCHAR}) -->
        insert into br30_xzcs_info_zc(bdhm ,ccxh ,zcxh ,zcmc ,zclx ,cpxszl, dqh ,jrcpbh ,lczh ,zjhkzh, zcglr, zckfjy,
        zcjyxz, xzxcrq ,zyqr, tgr ,syr, clr , shr, tgzh ,jldw ,bz ,zcdwjg,
        se, kyse, zczje, beiz, khzh, qrydt, khwddm )
        values
        (#{bdhm,jdbcType=VARCHAR} ,#{ccxh,jdbcType=VARCHAR} ,#{zcxh,jdbcType=VARCHAR} ,#{zcmc,jdbcType=VARCHAR} ,#{zclx,jdbcType=VARCHAR} ,
        #{cpxszl,jdbcType=VARCHAR},#{dqh,jdbcType=VARCHAR} ,#{jrcpbh,jdbcType=VARCHAR} ,
        #{lczh,jdbcType=VARCHAR} ,#{zjhkzh,jdbcType=VARCHAR},#{zcglr,jdbcType=VARCHAR}, #{zckfjy,jdbcType=VARCHAR},
        #{zcjyxz,jdbcType=VARCHAR} ,#{xzxcrq,jdbcType=VARCHAR}, #{zyqr,jdbcType=VARCHAR} ,#{tgr,jdbcType=VARCHAR}, #{syr,jdbcType=VARCHAR} ,
        #{clr,jdbcType=VARCHAR}, #{shr,jdbcType=VARCHAR} ,#{tgzh,jdbcType=VARCHAR} ,#{jldw,jdbcType=VARCHAR} ,#{bz,jdbcType=VARCHAR} ,#{zcdwjg,jdbcType=VARCHAR},
        #{se,jdbcType=VARCHAR}, #{kyse,jdbcType=VARCHAR}, #{zczje,jdbcType=VARCHAR},#{beiz,jdbcType=VARCHAR}, #{khzh,jdbcType=VARCHAR}, #{qrydt,jdbcType=VARCHAR},
        #{khwddm,jdbcType=VARCHAR})
    </insert>
    <insert id="insertBr30_xzcs_info_cs_hx" parameterType="com.citic.server.gf.domain.request.QueryRequest_Jrxx">
        insert into br30_xzcs_info_cs (bdhm, ccxh, csxh,zcxh,jrcpbh, djjzrq, djjg, djwh, djje, beiz,
        qrydt)
        values (#{bdhm}, #{ccxh}, #{csxh,jdbcType=VARCHAR},  #{zcxh}, #{jrcpbh,jdbcType=VARCHAR},#{djjzrq,jdbcType=VARCHAR}, #{djjg,jdbcType=VARCHAR},
        #{djwh,jdbcType=VARCHAR},
        #{djje,jdbcType=VARCHAR}, #{beiz,jdbcType=VARCHAR}, #{qrydt,jdbcType=VARCHAR})
    </insert>
    <insert id="insertBr30_xzcs_info_wl_hx" parameterType="com.citic.server.gf.domain.request.QueryRequest_Wlxx">
        insert into br30_xzcs_info_wl (bdhm, ccxh, wlxh, jyzl, zjlx, bz, je, jysj, jylsh,
        zckzxm, zckzh, zckzhkhh, jydsyhhh, jydszjlx, jydszjhm, jydstxdz,
        jydsyzbm, jydslxdh, beiz, khzh, organkey, qrydt)
        values
        (#{bdhm},#{ccxh},#{wlxh,jdbcType=VARCHAR},
        #{jyzl,jdbcType=VARCHAR},#{zjlx,jdbcType=VARCHAR},#{bz,jdbcType=VARCHAR},
        #{je,jdbcType=VARCHAR},#{jysj,jdbcType=VARCHAR},#{jylsh,jdbcType=VARCHAR},#{zckzxm,jdbcType=VARCHAR},
        #{zckzh,jdbcType=VARCHAR},#{zckzhkhh,jdbcType=VARCHAR},#{jydsyhhh,jdbcType=VARCHAR},#{jydszjlx,jdbcType=VARCHAR},
        #{jydszjhm,jdbcType=VARCHAR},#{jydstxdz,jdbcType=VARCHAR},
        #{jydsyzbm,jdbcType=VARCHAR},#{jydslxdh,jdbcType=VARCHAR},#{beiz,jdbcType=VARCHAR},#{khzh,jdbcType=VARCHAR},#{organkey,jdbcType=VARCHAR},#{qrydt,jdbcType=VARCHAR})
    </insert>
    <insert id="insertBr30_xzcs_info_ql_hx" parameterType="com.citic.server.gf.domain.request.QueryRequest_Qlxx">
        insert into br30_xzcs_info_ql (bdhm, ccxh, xh,zcxh,jrcpbh, qllx, qlr, qlje, qlrdz, qlrlxfs, djje,
        khzh, khwddm, qrydt)
        values (#{bdhm,jdbcType=VARCHAR}, #{ccxh,jdbcType=VARCHAR}, #{xh,jdbcType=VARCHAR},  #{zcxh,jdbcType=VARCHAR}, #{jrcpbh,jdbcType=VARCHAR},#{qllx,jdbcType=VARCHAR},
        #{qlr,jdbcType=VARCHAR}, #{qlje,jdbcType=VARCHAR}, #{qlrdz,jdbcType=VARCHAR}, #{qlrlxfs,jdbcType=VARCHAR},
        #{djje,jdbcType=VARCHAR},
        #{khzh,jdbcType=VARCHAR}, #{khwddm,jdbcType=VARCHAR}, #{qrydt,jdbcType=VARCHAR})

    </insert>
    <insert id="insertBr30_xzcs_info_glxx_hx" parameterType="com.citic.server.gf.domain.request.QueryRequest_Glxx">
        insert into br30_xzcs_info_glxx (bdhm, ccxh, glxh, zkhzh, glzhlb, glzhhm, bz, ye,
        kyye, beiz, qrydt)
        values (#{bdhm}, #{ccxh}, #{glxh,jdbcType=VARCHAR}, #{zkhzh,jdbcType=VARCHAR}, #{glzhlb,jdbcType=VARCHAR},
        #{glzhhm,jdbcType=VARCHAR},
        #{bz,jdbcType=VARCHAR}, #{ye,jdbcType=VARCHAR}, #{kyye,jdbcType=VARCHAR}, #{beiz,jdbcType=VARCHAR},
        #{qrydt,jdbcType=VARCHAR})
    </insert>
    <select id="getBr30_xzcs_info_wlList2" parameterType="com.citic.server.gf.domain.request.QueryRequest_Wlxx" resultType="com.citic.server.gf.domain.request.QueryRequest_Wlxx">
        select
        organkey,
        tx_type_cd as jyzl,
        debit_credit as zjlx,
        crtp as bz,
        crat as je,
        dt_time as jysj,
        tx_no as jylsh,
        tcnm as zckzxm,
        tcac as zckzh,
        cfin
        as zckzhkhh,
        cfic as jydsyhhh
        from
        bb11_trans
        <where>
            <if test="khzh != null  and khzh != '' ">
                acct_num = #{khzh}
            </if>
            <if test="khrq != null  and khrq != '' ">
                and <![CDATA[ dt_time  >=  #{khrq} ]]>
            </if>
            <if test="xhrq != null  and xhrq != '' ">
                and <![CDATA[ dt_time  <=  #{xhrq} ]]>
            </if>
        </where>
    </select>

    <delete id="delBr30_xzcs_info" parameterType="string">
		<![CDATA[ delete from br30_xzcs_info  where bdhm=#{bdhm} ]]>
    </delete>
    <delete id="delBr30_xzcs_info_wl" parameterType="string">
		<![CDATA[ delete from br30_xzcs_info_wl  where bdhm=#{bdhm} ]]>
    </delete>
    <delete id="delBr30_xzcs_info_cs" parameterType="string">
		<![CDATA[ delete from br30_xzcs_info_cs  where bdhm=#{bdhm} ]]>
    </delete>
    <delete id="delBr30_xzcs_info_zc" parameterType="string">
		<![CDATA[ delete from br30_xzcs_info_zc  where bdhm=#{bdhm} ]]>
    </delete>
    <delete id="delBr30_xzcs_info_ql" parameterType="string">
		<![CDATA[ delete from br30_xzcs_info_ql  where bdhm=#{bdhm} ]]>
    </delete>
    <delete id="delBr30_xzcs_info_glxx" parameterType="string">
		<![CDATA[ delete from br30_xzcs_info_glxx  where bdhm=#{bdhm} ]]>
    </delete>
    <delete id="delBr32_msg" parameterType="com.citic.server.gf.domain.Br32_msg">
		<![CDATA[ delete from br32_msg where bdhm=#{bdhm} and  packetkey=#{packetkey} ]]>
    </delete>

    <select id="getTransWlxxInfoList" parameterType="com.citic.server.gf.domain.response.QueryResponse_Cxqq" resultType="com.citic.server.gf.domain.request.QueryRequest_Wlxx">
        select acct_num as khzh,tx_type_cd as jyzl,debit_credit as zjlx,crtp as bz,crat as je
        dt_time as jysj,tx_no as jylsh,tcnm as zckzxm,tcac as
        zckzh,tcit as jydszjlx,
        tcid as jydszjhm,cfin as jydsyhhh,jydstxdz,jydsyzbm,jydslxdh,
        des as transactionremark,organkey as
        transactionbranchcode,temp1 as beiz
        from bb11_trans
        where acct_num = #{khzh}
        <if test="ckkssj  !=null  and ckkssj != '' ">
            and <![CDATA[ dt_time  >=  #{ckkssj} ]]>
        </if>
        <if test="ckjssj !=null  and ckjssj != '' ">
            and <![CDATA[ dt_time  <=  #{ckjssj} ]]>
        </if>
    </select>
    
    <delete id="deleteBr32_jg" parameterType="string">
        delete from br32_jg where bdhm = #{bdhm}
    </delete>
    <insert id="insertBr32_jg" parameterType="com.citic.server.gf.domain.Result_Jg">
        insert into br32_jg(bdhm, code, msg, qrydt) values (#{bdhm}, #{result}, #{msg}, #{qrydt})
    </insert>
</mapper>


