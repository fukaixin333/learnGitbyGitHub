<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.citic.server.net.mapper.BR22_caseMapper">

	
		<select id="getBr22_Case_ajjb_List" parameterType="string"  resultType="com.citic.server.dx.domain.request.CaseRequest100401">
		select   a.applicationtype  as applicationType
         , a.create_dt    as  reportEndTime
         , a.casename        as victimName
         , a.telphone        as  victimPhoneNumber
         , a.citp            as  victimIDType
         , a.ctid            as victimIDNumber
         , a.event_desc       as accidentDescription
         ,a.recheck_user   as operatorName
         ,b.telephone as operatorPhoneNumber,a.caseid,a.msg_type_cd,a.featurecodetype,a.orgkey,a.toorg
		from br22_case a left join mp02_user b  on a.recheck_user=b.loginname
		where a.caseid =#{_parameter}
	</select>
	
		<select id="getBr22_CaseList" parameterType="string"  resultType="com.citic.server.dx.domain.Cs_case">
		select  a.*
		from br22_case a 
		where a.caseid =#{_parameter}
	</select>
	
	   
	   	<select id="getBr22_Case_transByCaseIdList" parameterType="string"  resultType="com.citic.server.dx.domain.request.SuspiciousRequest_Transaction">
             
		select   a.accountnumber,
   transactiontype  as  transactionType,
   borrowingsigns   as  borrowingSigns,
   currency         as   currency,
   transamt         as   transactionAmount,
   accountbalance   as   accountBalance,
   transactiontime  as   transactionTime,
   transactionserial as   transactionSerial,
   opp_name          as   opponentName,
   opp_acctnum       as   opponentAccountNumber,
   opp_crednum       as     opponentCredentialNumber,
   opp_openbank_id   as   opponentDepositBankID,
   transremark       as    transactionRemark,
   organname         as   transactionBranchName,
   organkey          as    transactionBranchCode,
   logNumber,
   summonsNumber,
   voucherType,
   voucherCode,
   cashMark,
   terminalNumber,
   transactionStatus,
   transactionAddress,
   merchantName,
   merchantCode,
   IPADRESS as ipAddress,
   mac,
   tellerCode,
   remark
   from bb21_trans a,br22_case_trans b
		where a.trans_key=b.trans_key
		and b.caseid =#{_parameter}
		
	   </select>
	   
	     	<select id="getBr22_PCase_transByCaseIdList" parameterType="string"  resultType="com.citic.server.dx.domain.request.CaseRequest_Transaction">
        select   distinct       a.transactionserial  as   ID
            ,a.transactiontime    as   Time
            ,a.transactiontype    as   Type
            ,a.currency           as   Currency
            ,a.transamt           as   TransferAmount
            ,a.organkey           as   TransferOutBankID
            ,a.organkey          as   TransferOutBankName
            ,a.accountname        as   TransferOutAccountName
            ,a.cardnumber      as   TransferOutAccountNumber
            ,a.opp_openbank_id    as   TransferInBankID
            ,a.opp_openbank       as   TransferInBankName
            ,a.opp_name           as   TransferInAccountName
            ,a.opp_cardnum        as   TransferInAccountNumber
            ,a.ipadress           as   IP
            ,a.mac                as   MAC
            ,a.tstp_type_f_cd     as   DeviceID
            ,a.transactionaddress as   Place
            ,a.remark             as   Remark
            ,BorrowingSigns
            ,isCeased
		from bb21_trans a,br22_case_trans b
		where a.trans_key=b.trans_key
		and b.caseid =#{_parameter}
		
	   </select>
	   
	 <select id="getBr22_Case_CardByCaseIdList" parameterType="string"  resultType="com.citic.server.dx.domain.request.SuspiciousRequest_Accounts">	
		 select distinct  b.cardnumber as cardNumber ,b.opendate as accountOpenTime,b.open_organkey 
         From br22_case_party a,bb11_card b
         where a.cardnumber=b.cardnumber
		     and a.caseid =#{_parameter}		
	   </select>
	   
	   	<select id="getBr22_CaseMinAcct" parameterType="string"  resultType="com.citic.server.dx.domain.request.SuspiciousRequest100404">
   select d.*,b.open_organkey as accountopenplace
   from(
    select  distinct c.subjectname as accountname,  c.citp as idtype,c.ctid as idnumber,c.telnumber as phonenumber, 
     c.residentaddr as address ,c.postalcode as postcode,a.cardnumber,e.orgkey
    from br22_case e, br22_case_party a,bb21_party c
     where e.caseid=a.caseid and  a.party_id=c.party_id
      and  a.caseid =#{_parameter}  	
      )d
      left join bb21_card b   on b.cardnumber=d.cardnumber
	</select>
	
	   	<select id="getBr22_Case_acctByCaseIdList" parameterType="string"  resultType="com.citic.server.dx.domain.request.SuspiciousRequest_Account">
   select  distinct b.accountnumber,b.accountserial,b.accounttype,b.accountstatus,b.currency,b.cashremit,b.accountname,b.cardnumber
    from br22_case_party a,bb21_acct b   WHERE a.acct_num=b.accountnumber
    and a.caseid =#{_parameter} 
	</select>
	
	 	<select id="getCaseAttach" parameterType="string"  resultType="com.citic.server.dx.domain.Attachment">
	  select *
    from  br22_attach
    where caseid =#{_parameter} 
	</select>
	
	<update id="updateCaseStatus" parameterType="com.citic.server.dx.domain.Cs_case"  >
	  update  br22_case set  status_cd=#{status_cd}
    where caseid =#{caseid} 
	</update>
	
		<delete id="deleteBr22Msg" parameterType="com.citic.server.dx.domain.Br22_Msg"  >
	      delete from   br22_msg 
       where caseid =#{caseid}  and msg_type_cd=#{msg_type_cd}  
	</delete>
	<delete id="insertBr22Msg" parameterType="com.citic.server.dx.domain.Br22_Msg"  >
	     insert into br22_msg(msgkey,caseid,applicationid,msg_type_cd,featurecodetype,msg_filename,msg_filepath,create_dt) 
       values(#{msgkey} ,#{caseid}  ,#{applicationid}  ,#{msg_type_cd}  ,#{featurecodetype}  ,#{msg_filename}  ,#{msg_filepath}  ,#{create_dt}   ) 
	</delete>
	
		  <select id="getBr22_MsgList" parameterType="com.citic.server.dx.domain.Br22_Msg"  resultType="com.citic.server.dx.domain.Br22_Msg">
	  select *
    from br22_msg 
    		<where>
		<if test="caseid!=null  and caseid!=''">
		   caseid =#{caseid} 
		</if>
    		<if test="msg_type_cd=null  and msg_type_cd!=''">
		    and msg_type_cd=#{msg_type_cd}
		</if>
			<if test="applicationid=null  and applicationid!=''">
		    and applicationid=#{applicationid}
		</if>
		</where>
	</select>
	
		<update id="updateBr22_Stop" parameterType="com.citic.server.dx.domain.Br22_StopPay"  >
	  update  br22_stop set  applicationid=#{applicationID} 
      where caseid =#{caseid} 
	</update>
	
	
		<delete id="delBr22_CASE_BACK" parameterType="String">  
  		<![CDATA[ delete from br22_case_back where caseid=#{_parameter} ]]>
	</delete>
	
		<insert id="insertBr22_CASE_BACK" parameterType="com.citic.server.dx.domain.response.CaseResponse100402">
		insert into br22_case_back(
		caseid,messagefrom,transserialnumber,applicationid,applicationtype,
		reportendtime,result,operatorname,operatorphonenumber,feedbackorgname,feedbackremark
			) values(
		#{caseid},#{messageFrom},#{transSerialNumber},#{applicationID},#{applicationType,jdbcType=VARCHAR},
		#{reportEndTime,jdbcType=VARCHAR},#{result,jdbcType=VARCHAR},#{operatorName,jdbcType=VARCHAR},
		#{operatorPhoneNumber,jdbcType=VARCHAR},#{feedbackOrgName,jdbcType=VARCHAR},#{feedbackRemark,jdbcType=VARCHAR}
		)
	</insert>
	

</mapper>


