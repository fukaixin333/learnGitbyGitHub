<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.citic.server.jsga.mapper.MM40_cxqq_jsgaMapper">

    <delete id="delBr40_cxqq" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from br40_cxqq where qqdbs=#{qqdbs} and tasktype = #{tasktype} ]]>
    </delete>

    <insert id="insertBr40_cxqq" parameterType="com.citic.server.jsga.domain.Br40_cxqq">
        insert into br40_cxqq(
        qqdbs,qqcslx,tasktype,sqjgdm,mbjgdm,ztlb,ajlx,jjcd,beiz,
        fssj,qqrxm,qqrzjlx,qqrzjhm,qqrdwmc,qqrsjh,xcrxm,xcrzjlx,
        xcrzjhm,status,orgkey,qrydt,qqrbgdh,xcrsjh,xcrbgdh
        ) values(
        #{qqdbs, jdbcType=VARCHAR},
        #{qqcslx, jdbcType=VARCHAR},
        #{tasktype, jdbcType=VARCHAR},
        #{sqjgdm, jdbcType=VARCHAR},
        #{mbjgdm, jdbcType=VARCHAR},
        #{ztlb,
        jdbcType=VARCHAR},
        #{ajlx, jdbcType=VARCHAR},
        #{jjcd, jdbcType=VARCHAR},
        #{beiz, jdbcType=VARCHAR},
        #{fssj, jdbcType=VARCHAR},
        #{qqrxm, jdbcType=VARCHAR},
        #{qqrzjlx, jdbcType=VARCHAR},
        #{qqrzjhm, jdbcType=VARCHAR},
        #{qqrdwmc, jdbcType=VARCHAR},
        #{qqrsjh, jdbcType=VARCHAR},
        #{xcrxm, jdbcType=VARCHAR},
        #{xcrzjlx, jdbcType=VARCHAR},
        #{xcrzjhm, jdbcType=VARCHAR},
        #{status, jdbcType=VARCHAR},
        #{orgkey,
        jdbcType=VARCHAR},
        #{qrydt, jdbcType=VARCHAR},
        #{qqrbgdh, jdbcType=VARCHAR},
        #{xcrsjh, jdbcType=VARCHAR},
        #{xcrbgdh, jdbcType=VARCHAR}
        )
    </insert>

    <delete id="delBr40_cxqq_mx" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
	 	 <![CDATA[ delete from br40_cxqq_mx where QQDBS=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>

    <insert id="insertBr40_cxqq_mx" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        insert into br40_cxqq_mx(
        rwlsh,qqdbs,zzlx,zzhm,cxzh,ztmc,cxnr,mxsdlx,mxqssj,mxjzsj,
        qrydt,orgkey,tasktype,cxlx,yrwlsh,cxfs,ztlb,xmltype
        ) values(
        #{rwlsh,jdbcType=VARCHAR},
        #{qqdbs,jdbcType=VARCHAR},
        #{zzlx,jdbcType=VARCHAR},
        #{zzhm,jdbcType=VARCHAR},
        #{cxzh,jdbcType=VARCHAR},
        #{ztmc,jdbcType=VARCHAR},
        #{cxnr,jdbcType=VARCHAR},
        #{mxsdlx,jdbcType=VARCHAR},
        #{mxqssj,jdbcType=VARCHAR},
        #{mxjzsj,jdbcType=VARCHAR},
        #{qrydt,jdbcType=VARCHAR},
        #{orgkey,jdbcType=VARCHAR},
        #{tasktype,jdbcType=VARCHAR},
        #{cxlx,jdbcType=VARCHAR},
        #{yrwlsh,jdbcType=VARCHAR},
        #{cxfs,jdbcType=VARCHAR},
        #{ztlb,jdbcType=VARCHAR},
        #{xmltype,jdbcType=VARCHAR}
        )
    </insert>

    <delete id="delBr40_wh_attach" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
	 	 <![CDATA[ delete from br40_wh_attach where qqdbs=#{qqdbs} and tasktype =#{tasktype}]]>
    </delete>

    <delete id="delBr40_cxqq_back" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from br40_cxqq_back where qqdbs=#{qqdbs}  and tasktype =#{tasktype}  and rwlsh = #{rwlsh} ]]>
    </delete>

    <insert id="insertBr40_cxqq_back" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back">
        insert into BR40_CXQQ_BACK (
        qqdbs,rwlsh,seq,sqjgdm,mbjgdm,ztlb,cxjssj,zh,kh,cxfkjg,czsbyy,status,qrydt,orgkey,fksjhm,zxqssj,zxsjqj,jssj,tasktype,msgcheckresult
        )
        values (
        #{qqdbs},#{rwlsh},#{seq},#{sqjgdm,jdbcType=VARCHAR},#{mbjgdm,jdbcType=VARCHAR},#{ztlb,jdbcType=VARCHAR},#{cxjssj,jdbcType=VARCHAR},#{zh,jdbcType=VARCHAR},#{kh,jdbcType=VARCHAR},#{cxfkjg,jdbcType=VARCHAR},#{czsbyy,jdbcType=VARCHAR},#{status},#{qrydt},#{orgkey},#{fksjhm,jdbcType=VARCHAR},#{zxqssj,jdbcType=VARCHAR},#{zxsjqj,jdbcType=VARCHAR},#{jssj,jdbcType=VARCHAR},#{tasktype},#{msgcheckresult}
        )
    </insert>

    <insert id="insertBr40_wh_attach" parameterType="com.citic.server.jsga.domain.Br40_cxqq">
        insert into Br40_wh_attach(
        fileno,qqdbs,wjmc,wjlx,wslx,filepath,create_dt,tasktype,wsbh
        ) select
        xh,bdhm,wjmc,wjlx,wslb,wspath,#{fssj},#{tasktype},wsbh
        from mc20_ws where bdhm=#{qqdbs}
    </insert>

    <select id="selectBr40_cxqqByVo" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.Br40_cxqq">
        select
        qqdbs,qqcslx,tasktype,sqjgdm,mbjgdm,ztlb,ajlx,
        jjcd,beiz,fssj,qqrxm,qqrzjlx,qqrzjhm,qqrdwmc,
        qqrsjh,xcrxm,xcrzjlx,xcrzjhm,status,orgkey,qrydt
        from br40_cxqq
        where qqdbs = #{qqdbs} and tasktype = #{tasktype}
    </select>

    <select id="selectBr40_cxqq_backByVo" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.Br40_cxqq_back">
        select
        qqdbs,rwlsh,seq,sqjgdm,mbjgdm,ztlb,cxjssj,zh,kh,cxfkjg,czsbyy,status,qrydt,orgkey,fksjhm,zxqssj,zxsjqj,jssj,tasktype,msgcheckresult
        from br40_cxqq_back
        where qqdbs = #{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh}
        <if test="seq != null  and seq != '' ">
            and seq = #{seq}
        </if>
    </select>

    <select id="selectBr40_cxqq_backByList" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.Br40_cxqq_back">
        select
        qqdbs,rwlsh,seq,sqjgdm,mbjgdm,ztlb,cxjssj,zh,kh,cxfkjg,czsbyy,status,qrydt,orgkey,fksjhm,zxqssj,zxsjqj,jssj,tasktype,msgcheckresult
        from br40_cxqq_back where qqdbs = #{qqdbs} and tasktype =
        #{tasktype}
    </select>

    <select id="selectBr40_cxqq_mxByVo" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        select
        rwlsh,qqdbs,zzlx,zzhm,cxzh,ztmc,cxnr,mxsdlx,mxqssj,mxjzsj,qrydt,orgkey,tasktype,cxlx,yrwlsh,cxfs,ztlb,xmltype
        from br40_cxqq_mx where tasktype = #{tasktype} and rwlsh= #{rwlsh}
        <if test="qqdbs != null and qqdbs != ''">
            and qqdbs = #{qqdbs}
        </if>
    </select>

    <select id="getPartyMsg_IdNum" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Customer">
        select
        t2.qqdbs,
        t2.rwlsh,
        t2.tasktype,
        t1.party_id,
        t1.citp as zzlx,
        t1.ctid as zzhm,
        t1.ctnm as khmc,
        t1.cctl_t as lxdh,
        t1.cctl_p as lxsj,
        t1.agent_name as dbrxm,
        t1.agent_id_type_o as dbrzjlx,
        t1.agent_id_no as dbrzjhm,
        t1.ctar as zzdz,
        t1.resident_tel_number as zzdh,
        t1.workcompanyname as gzdw,
        t1.workaddress as dwdz,
        t1.worktelnumber as dwdh,
        t1.ccei_email as yxdz,
        t1.cb_name as wyzhm,
        t1.cb_open_dt as wyblrq,
        t1.cb_open_organ_name as wykhwd,
        t1.cb_open_organkey_pboc as wykhwddm,
        t1.cb_open_organ_address as wykhwdszd,
        t1.mb_name as sjyhzhm,
        t1.mb_open_dt as sjyhblrq,
        t1.mb_open_organ_name as sjyhkhwd,
        t1.mb_open_organkey_pboc as sjyhkhwddm,
        t1.mb_open_organ_address as sjyhkhwdszd
        from
        bb11_party t1,br40_cxqq_mx t2
        where t1.ctid = t2.zzhm
        and t1.ctid = #{zzhm}

    </select>

    <select id="getPartyMsg_CardId" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Customer">
        select t1.party_id,
        t1.citp_exp as zzlx,
        t1.ctid as ctid,
        t1.ctnm as khmc,
        t1.cctl_t as lxdh,
        t1.cctl_p as lxsj,
        t1.agent_name as dbrxm,
        t1.agent_id_type_o as dbrzjlx,
        t1.agent_id_no as dbrzjhm,
        t1.ctar as zzdz,
        t1.resident_tel_number as zzdh,
        t1.workcompanyname as gzdw,
        t1.workaddress as dwdz,
        t1.worktelnumber as dwdh,
        t1.ccei_email as yxdz,
        t1.cb_name as wyzhm,
        t1.cb_open_dt as wyblrq,
        t1.cb_open_organ_name as wykhwd,
        t1.cb_open_organkey_pboc as wykhwddm,
        t1.cb_open_organ_address as wykhwdszd,
        t1.mb_name as sjyhzhm,
        t1.mb_open_dt as sjyhblrq,
        t1.mb_open_organ_name as sjyhkhwd,
        t1.mb_open_organkey_pboc as sjyhkhwddm,
        t1.mb_open_organ_address as sjyhkhwdszd
        from bb11_party t1,bb11_id_deposit
        t2
        where t1.party_id = t2.party_id
        and t2.card_num=#{cxzh}
    </select>

    <select id="getPartyMsg_AcctId" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Customer">
        select t1.party_id,
        t1.citp_exp as zzlx,
        t1.ctnm as khmc,
        t1.cctl_t as lxdh,
        t1.cctl_p as lxsj,
        t1.agent_name as dbrxm,
        t1.agent_id_type_o as dbrzjlx,
        t1.agent_id_no as dbrzjhm,
        t1.ctar as zzdz,
        t1.resident_tel_number as zzdh,
        t1.workcompanyname as gzdw,
        t1.workaddress as dwdz,
        t1.worktelnumber as
        dwdh,
        t1.ccei_email as yxdz,
        t1.agent_tel as dbrlxdh,
        t1.cb_name as wyzhm,
        t1.cb_open_dt as wyblrq,
        t1.cb_open_organ_name as wykhwd,
        t1.cb_open_organkey_pboc as wykhwddm,
        t1.cb_open_organ_address as
        wykhwdszd,
        t1.mb_name as sjyhzhm,
        t1.mb_open_dt as sjyhblrq,
        t1.mb_open_organ_name as sjyhkhwd,
        t1.mb_open_organkey_pboc as sjyhkhwddm,
        t1.mb_open_organ_address as sjyhkhwdszd
        from bb11_party
        t1,bb11_deposit_c t2
        where t1.party_id = t2.party_id
        and t2.ctac=#{cxzh}
    </select>


    <select id="getLocalPrivateAcctInfo" parameterType="String" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Account">
        select
        t1.acct_num as kh,
        t1.acct_num as zh,
        t1.ctac as ctac,
        t1.acct_type as zhlb,
        t1.status_cd as zhzt,
        t1.organkey as
        khwddm,
        t1.oatm as khrq,
        t1.catm as xhrq,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.amtval as kyye,
        t1.last_occur_dt as zhjysj,
        t1.remark as beiz,
        t1.cancel_organkey as xhwddm,
        t1.mature_dt
        as yxq
        from bb11_id_deposit t1
        where t1.party_id =#{partyid}
    </select>

    <select id="getLocalPublicAcctInfo" parameterType="String" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Account">
        select
        t1.acct_num as kh,
        t1.acct_num as zh,
        t1.ctac as ctac,
        t1.acct_type as zhlb,
        t1.status_cd as zhzt,
        t1.organkey as khwddm,
        t1.oatm as khrq,
        t1.catm as xhrq,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.amtval as kyye,
        t1.last_occur_dt as zhjysj,
        t1.remark as beiz,
        t1.cancel_organkey as xhwddm,
        t1.mature_dt
        as
        yxq
        from bb11_deposit_c t1
        where t1.party_id =#{partyid}
    </select>


    <insert id="insertPartyInfo" parameterType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Customer">
        insert into BR40_CXQQ_BACK_PARTY (
        qqdbs,rwlsh,cxfkjg,cxfkjgyy,zzlx,zzhm,khmc,lxdh,lxsj,dbrxm,dbrzjlx,dbrzjhm,zzdz,zzdh,gzdw,dwdz,dwdh,yxdz,frdb,frdbzjlx,frdbzjhm,khgszzhm,gsnsh,dsnsh,qrydt,tasktype
        ) values (
        #{qqdbs},#{rwlsh},#{cxfkjg,jdbcType=VARCHAR},#{cxfkjgyy,jdbcType=VARCHAR},#{zzlx,jdbcType=VARCHAR},#{zzhm,jdbcType=VARCHAR},#{khmc,jdbcType=VARCHAR},#{lxdh,jdbcType=VARCHAR},#{lxsj,jdbcType=VARCHAR},#{dbrxm,jdbcType=VARCHAR},#{dbrzjlx,jdbcType=VARCHAR},#{dbrzjhm,jdbcType=VARCHAR},#{zzdz,jdbcType=VARCHAR},#{zzdh,jdbcType=VARCHAR},#{gzdw,jdbcType=VARCHAR},#{dwdz,jdbcType=VARCHAR},#{dwdh,jdbcType=VARCHAR},#{yxdz,jdbcType=VARCHAR},#{frdb,jdbcType=VARCHAR},#{frdbzjlx,jdbcType=VARCHAR},#{frdbzjhm,jdbcType=VARCHAR},#{khgszzhm,jdbcType=VARCHAR},#{gsnsh,jdbcType=VARCHAR},#{dsnsh,jdbcType=VARCHAR},#{qrydt,jdbcType=VARCHAR},#{tasktype,jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertAcctInfo" parameterType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Account">
        insert into BR40_CXQQ_BACK_ACCT (
        qqdbs,rwlsh,kh,zh,zhlb,zhzt,khwd,khwddm,khrq,xhrq,xhwd,bz,chbz,zhye,kyye,zhjysj,beiz,qrydt,ctac,tasktype
        ) values (
        #{qqdbs,jdbcType=VARCHAR},#{rwlsh,jdbcType=VARCHAR},#{kh,jdbcType=VARCHAR},#{zh,jdbcType=VARCHAR},#{zhlb,jdbcType=VARCHAR},#{zhzt,jdbcType=VARCHAR},#{khwd,jdbcType=VARCHAR},#{khwddm,jdbcType=VARCHAR},#{khrq,jdbcType=VARCHAR},#{xhrq,jdbcType=VARCHAR},#{xhwd,jdbcType=VARCHAR},#{bz,jdbcType=VARCHAR},#{chbz,jdbcType=VARCHAR},#{zhye,jdbcType=VARCHAR},#{kyye,jdbcType=VARCHAR},#{zhjysj,jdbcType=VARCHAR},#{beiz,jdbcType=VARCHAR},#{qrydt,jdbcType=VARCHAR},#{ctac,jdbcType=VARCHAR},#{tasktype,jdbcType=VARCHAR}
        )
    </insert>
    <insert id="insertBr40_cxqq_back_acct_qzcs1" parameterType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Measure">
        insert into br40_cxqq_back_acct_qzcs(
        qqdbs,rwlsh,zh,csxh,djksrq,djjzrq,djjgmc,djje,beiz,djcslx,qrydt,tasktype
        ) values (
        #{qqdbs,jdbcType=VARCHAR},#{rwlsh,jdbcType=VARCHAR},#{zh,jdbcType=VARCHAR},#{csxh,jdbcType=VARCHAR},#{djksrq,jdbcType=VARCHAR},#{djjzrq,jdbcType=VARCHAR},#{djjgmc,jdbcType=VARCHAR},#{djje,jdbcType=VARCHAR},#{beiz,jdbcType=VARCHAR},#{djcslx,jdbcType=VARCHAR},#{qrydt,jdbcType=VARCHAR},#{tasktype,jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertBr40_cxqq_back_acct_sub1" parameterType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_SubAccount">
        insert into br40_cxqq_back_acct_sub (
        qqdbs,rwlsh,zh,zzhxh,zzhlb,zzhzh,bz,chbz,zhye,zhzt,kyye,qrydt,tasktype
        ) values (
        #{qqdbs,jdbcType=VARCHAR},#{rwlsh,jdbcType=VARCHAR},#{zh,jdbcType=VARCHAR},#{zzhxh,jdbcType=VARCHAR},#{zzhlb,jdbcType=VARCHAR},#{zzhzh,jdbcType=VARCHAR},#{bz,jdbcType=VARCHAR},#{chbz,jdbcType=VARCHAR},#{zhye,jdbcType=VARCHAR},#{zhzt,jdbcType=VARCHAR},#{kyye,jdbcType=VARCHAR},#{qrydt,jdbcType=VARCHAR},#{tasktype,jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertBr40_cxqq_back_acct_ql1" parameterType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Priority">
        insert into br40_cxqq_back_acct_ql (
        tasktype,qqdbs,rwlsh,zh,xh,qllx,zzlxdm,zzhm,qlrxm,qlje,qlrdz,qlrlxfs,qrydt
        ) values (
        #{tasktype,jdbcType=VARCHAR},#{qqdbs,jdbcType=VARCHAR},#{rwlsh,jdbcType=VARCHAR},#{zh,jdbcType=VARCHAR},#{xh,jdbcType=VARCHAR},#{qllx,jdbcType=VARCHAR},#{zzlxdm,jdbcType=VARCHAR},#{zzhm,jdbcType=VARCHAR},#{qlrxm,jdbcType=VARCHAR},#{qlje,jdbcType=VARCHAR},#{qlrdz,jdbcType=VARCHAR},#{qlrlxfs,jdbcType=VARCHAR},#{qrydt,jdbcType=VARCHAR}
        )
    </insert>

    <insert id="insertBr40_cxqq_back_acct_qzcs" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        insert into br40_cxqq_back_acct_qzcs(
        qqdbs,rwlsh,zh,csxh,djksrq,djjzrq,djjgmc,djje,beiz,djcslx,qrydt,tasktype
        )
        select
        #{qqdbs},
        #{rwlsh},
        t1.acct_num as zh,
        t1.freezeserial as csxh,
        t1.freezestartdate as djksrq,
        t1.freezeenddate as djjzrq,
        t1.freezedeptname as djjgmc,
        t1.freezebalance as djje,
        t1.remark as beiz,
        t1.freezetype
        as
        djcslx,
        (select to_char(sysdate,'yyyy-mm-dd') from dual) as qrydt,
        #{tasktype}
        from bb11_freeze t1 ,br40_cxqq_back_acct t2
        where t1.acct_num = t2.zh
        and t2.qqdbs=#{qqdbs}
        and t2.rwlsh =#{rwlsh}
        and
        t2.tasktype = #{tasktype}
    </insert>


    <insert id="insertBr40_cxqq_back_acct_sub" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        insert into br40_cxqq_back_acct_sub (
        qqdbs,rwlsh,zh,zzhxh,zzhlb,zzhzh,bz,chbz,zhye,zhzt,kyye,qrydt,tasktype
        )
        select
        #{qqdbs},
        #{rwlsh},
        t1.acct_num as zh,
        t1.ctac_seq as zzhxh,
        t1.type_cd as zzhlb,
        '' as zzhzh,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.status_cd as zhzt,
        t1.amtval as kyye,
        (select
        to_char(sysdate,'yyyy-mm-dd') from dual) as qrydt,
        #{tasktype}
        from bb11_id_deposit t1,br40_cxqq_back_acct t2
        where t1.acct_num = t2.zh
        and t2.qqdbs=#{qqdbs}
        and t2.rwlsh =#{rwlsh}
        and t2.tasktype
        =
        #{tasktype}
        union
        select #{qqdbs},
        #{rwlsh},
        t1.acct_num as zh,
        t1.ctac_seq as zzhxh,
        t1.type_cd as zzhlb,
        '' as zzhzh,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.status_cd as
        zhzt,
        t1.amtval
        as kyye,
        (select to_char(sysdate,'yyyy-mm-dd') from dual) as qrydt,
        #{tasktype}
        from bb11_deposit_c t1,br40_cxqq_back_acct t2
        where t1.acct_num = t2.zh
        and t2.qqdbs=#{qqdbs}
        and
        t2.rwlsh
        =#{rwlsh}
        and t2.tasktype = #{tasktype}
    </insert>


    <insert id="insertBr40_cxqq_back_acct_ql" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        insert into br40_cxqq_back_acct_ql (
        tasktype,qqdbs,rwlsh,zh,xh,qllx,zzlxdm,zzhm,qlrxm,qlje,qlrdz,qlrlxfs,qrydt
        )
        select
        #{tasktype},
        #{qqdbs},
        #{rwlsh},
        t1.acct_num as zh,
        t1.rightserial as xh,
        t1.rightstype as qllx,
        t1.credentialtype as zzlxdm,
        t1.credentialnumber as zzhm,
        t1.obligeename as qlrxm,
        t1.rightsbalance as qlje,
        t1.obligeeaddress as
        qlrdz,
        t1.obligeecontactinfo as qlrlxfs,
        (select to_char(sysdate,'yyyy-mm-dd') from dual) as qrydt
        from bb11_right t1,br40_cxqq_back_acct t2
        where t1.acct_num = t2.zh
        and
        t2.qqdbs=#{qqdbs}
        and t2.rwlsh =#{rwlsh}
        and t2.tasktype = #{tasktype}
    </insert>

    <select id="getAcct_TransList" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Transaction">
        select
        tx_no as jylsh, voucher_no as cph, cash_ind as xjbz, debit_credit as jdbz,
        organkey as jywddm, dt_time as jysj, cardnumber as cxkh, acct_num as zh,
        ctac as ctac, card_num as pzh, card_type as pzzl, tx_type_cd as jylx, crtp as bz,
        crat as je, amt_val as ye, des as jyzy, trcd_area as jyfsd, cfic as jydfzhkhh,
        tcnm as jydfxm, tcac as jydfzh, tcid as jydfzjhm, bknm as dbrxm, bitp as dbrzjlx,
        bkid as dbrzjhm,
        teller as jygyh, merch_no as shh, tran_ip as ip, temp1 as beiz, opponentcardnumber as jydfkh,
        opponentaccountbalance as jydsye, lognumber as rzh, terminalnumber as zdh, merchantname as shmc,
        mac as mac, transactionstatus as jysfcg, dlyhm as dlyhm, jysxfbz as jysxfbz, jysxfje as jysxfje,
        jysxfzy as jysxfzy, agent_tel as dbrlxdh, party_name as zhmc
        from bb11_trans where 1 > 0
        <!-- 主体类别：01个人 -->
        <if test="ztlb == '01' and cxlx == '02' ">
            and cardnumber = #{cxzh}
        </if>
        <!-- 主体类别：02对公 -->
        <if test="ztlb == '02' and cxlx == '02' ">
            and acct_num = #{cxzh}
        </if>
        <if test="cxlx == '01' ">
            and party_id = #{partyid}
        </if>
        <!-- 明细时段类型：01表示开户至今；02表示当年数据；03自定义时间段； -->
        <if test="mxsdlx =='01' ">
            and tstm &lt;=(select to_char(sysdate,'yyyymmdd') from dual)
        </if>
        <if test="mxsdlx =='02' ">
            and substr(tstm,1,4) =(select to_char(sysdate,'yyyy') from dual)
        </if>
        <if test="mxsdlx =='03' ">
            and to_date(tstm,'yyyy-mm-dd') &gt;= to_date(#{mxqssj} ,'yyyy-mm-dd')
            and to_date(tstm,'yyyy-mm-dd') &lt;= to_date(#{mxjzsj},'yyyy-mm-dd')
        </if>
    </select>

    <insert id="insertBr40_cxqq_back_trans" parameterType="java.util.List">
        insert into BR40_CXQQ_BACK_TRANS (
        tasktype,qqdbs,rwlsh,transseq,cxfkjg,cxfkjgyy,
        cxkh,zh,jylx,jdbz,bz,je,ye,jysj,jylsh,jydfxm,
        jydfzh,jydfkh,jydfzjhm,jydsye,jydfzhkhh,jyzy,
        jywdmc,jywddm,rzh,cph,pzzl,pzh,xjbz,zdh,jysfcg,
        jyfsd,shmc,shh,ip,mac,jygyh,beiz,qrydt,zhmc,khmc,
        zzlx,zzhm,jydftxdz,jydflxdh
        )
        <choose>
            <when test="_databaseId == 'oracle'">
                <foreach collection="list" item="item" index="index" separator="UNION ALL">
                    select
                    #{item.tasktype},#{item.qqdbs},#{item.rwlsh},#{item.transseq,jdbcType=VARCHAR},#{item.cxfkjg,jdbcType=VARCHAR},
                    #{item.cxfkjgyy,jdbcType=VARCHAR},#{item.cxkh,jdbcType=VARCHAR},#{item.zh,jdbcType=VARCHAR},#{item.jylx,jdbcType=VARCHAR},
                    #{item.jdbz,jdbcType=VARCHAR},#{item.bz,jdbcType=VARCHAR},#{item.je,jdbcType=VARCHAR},#{item.ye,jdbcType=VARCHAR},
                    #{item.jysj,jdbcType=VARCHAR},#{item.jylsh,jdbcType=VARCHAR},#{item.jydfxm,jdbcType=VARCHAR},#{item.jydfzh,jdbcType=VARCHAR},
                    #{item.jydfkh,jdbcType=VARCHAR},#{item.jydfzjhm,jdbcType=VARCHAR},#{item.jydsye,jdbcType=VARCHAR},#{item.jydfzhkhh,jdbcType=VARCHAR},
                    #{item.jyzy,jdbcType=VARCHAR},#{item.jywdmc,jdbcType=VARCHAR},#{item.jywddm,jdbcType=VARCHAR},#{item.rzh,jdbcType=VARCHAR},
                    #{item.cph,jdbcType=VARCHAR},#{item.pzzl,jdbcType=VARCHAR},#{item.pzh,jdbcType=VARCHAR},#{item.xjbz,jdbcType=VARCHAR},
                    #{item.zdh,jdbcType=VARCHAR},#{item.jysfcg,jdbcType=VARCHAR},#{item.jyfsd,jdbcType=VARCHAR},#{item.shmc,jdbcType=VARCHAR},
                    #{item.shh,jdbcType=VARCHAR},#{item.ip,jdbcType=VARCHAR},#{item.mac,jdbcType=VARCHAR},#{item.jygyh,jdbcType=VARCHAR},
                    #{item.beiz,jdbcType=VARCHAR},#{item.qrydt,jdbcType=VARCHAR},#{item.zhmc,jdbcType=VARCHAR},#{item.khmc,jdbcType=VARCHAR},
                    #{item.zzlx,jdbcType=VARCHAR},#{item.zzhm,jdbcType=VARCHAR},#{item.jydftxdz,jdbcType=VARCHAR},#{item.jydflxdh,jdbcType=VARCHAR}
                    from MP01_DUAL
                </foreach>
            </when>
            <otherwise>
                values
                <foreach collection="list" item="item" index="index" separator=",">
                    (
                    #{item.tasktype},#{item.qqdbs},#{item.rwlsh},#{item.transseq,jdbcType=VARCHAR},#{item.cxfkjg,jdbcType=VARCHAR},
                    #{item.cxfkjgyy,jdbcType=VARCHAR},#{item.cxkh,jdbcType=VARCHAR},#{item.zh,jdbcType=VARCHAR},#{item.jylx,jdbcType=VARCHAR},
                    #{item.jdbz,jdbcType=VARCHAR},#{item.bz,jdbcType=VARCHAR},#{item.je,jdbcType=VARCHAR},#{item.ye,jdbcType=VARCHAR},
                    #{item.jysj,jdbcType=VARCHAR},#{item.jylsh,jdbcType=VARCHAR},#{item.jydfxm,jdbcType=VARCHAR},#{item.jydfzh,jdbcType=VARCHAR},
                    #{item.jydfkh,jdbcType=VARCHAR},#{item.jydfzjhm,jdbcType=VARCHAR},#{item.jydsye,jdbcType=VARCHAR},#{item.jydfzhkhh,jdbcType=VARCHAR},
                    #{item.jyzy,jdbcType=VARCHAR},#{item.jywdmc,jdbcType=VARCHAR},#{item.jywddm,jdbcType=VARCHAR},#{item.rzh,jdbcType=VARCHAR},
                    #{item.cph,jdbcType=VARCHAR},#{item.pzzl,jdbcType=VARCHAR},#{item.pzh,jdbcType=VARCHAR},#{item.xjbz,jdbcType=VARCHAR},
                    #{item.zdh,jdbcType=VARCHAR},#{item.jysfcg,jdbcType=VARCHAR},#{item.jyfsd,jdbcType=VARCHAR},#{item.shmc,jdbcType=VARCHAR},
                    #{item.shh,jdbcType=VARCHAR},#{item.ip,jdbcType=VARCHAR},#{item.mac,jdbcType=VARCHAR},#{item.jygyh,jdbcType=VARCHAR},
                    #{item.beiz,jdbcType=VARCHAR},#{item.qrydt,jdbcType=VARCHAR},#{item.zhmc,jdbcType=VARCHAR},#{item.khmc,jdbcType=VARCHAR},
                    #{item.zzlx,jdbcType=VARCHAR},#{item.zzhm,jdbcType=VARCHAR},#{item.jydftxdz,jdbcType=VARCHAR},#{item.jydflxdh,jdbcType=VARCHAR}
                    )
                </foreach>
            </otherwise>
        </choose>
    </insert>

    <select id="getCorpPartyInfo" parameterType="String" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Customer">
        select crnm as frdb,
        crit as frdbzjlx,
        crid as frdbzjhm,
        businesslicensenumber as khgszzhm,
        statetaxserial as gsnsh,
        localtaxserial
        as dsnsh
        from bb11_party_corp
        where party_id = #{partyid}
    </select>

    <delete id="delBr40_cxqq_back_acct" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from Br40_cxqq_back_acct where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>

    <delete id="delBr40_cxqq_back_acct_qzcs" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from Br40_cxqq_back_acct_qzcs where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>

    <delete id="delBr40_cxqq_back_acct_ql" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from Br40_cxqq_back_acct_ql where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>

    <delete id="delBr40_cxqq_back_acct_sub" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from Br40_cxqq_back_acct_sub where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>

    <delete id="delBr40_cxqq_back_trans" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from Br40_cxqq_back_trans where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>
    <delete id="delBr40_cxqq_back_party" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from Br40_cxqq_back_party where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>

    <select id="selectBr40_cxqq_back_party" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Customer">
        select * from br40_cxqq_back_party where qqdbs = #{qqdbs} and
        tasktype =
        #{tasktype}
        and rwlsh= #{rwlsh}
    </select>

    <select id="selectBr40_cxqq_back_acct" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Account">
        select * from Br40_cxqq_back_acct where qqdbs = #{qqdbs} and
        tasktype =
        #{tasktype}
        and rwlsh= #{rwlsh}
    </select>

    <select id="selectBr40_cxqq_back_acct_qzcs" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Measure">
        select * from Br40_cxqq_back_acct_qzcs where qqdbs =
        #{qqdbs} and tasktype =
        #{tasktype} and rwlsh= #{rwlsh}
    </select>

    <select id="selectBr40_cxqq_back_acct_ql" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Priority">
        select * from Br40_cxqq_back_acct_ql where qqdbs = #{qqdbs}
        and tasktype =
        #{tasktype} and rwlsh= #{rwlsh}
    </select>

    <select id="selectBr40_cxqq_back_acct_sub" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_SubAccount">
        select * from Br40_cxqq_back_acct_sub where qqdbs = #{qqdbs}
        and tasktype =
        #{tasktype} and rwlsh= #{rwlsh}
    </select>

    <select id="selectBr40_cxqq_back_trans" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Transaction">
        select * from Br40_cxqq_back_trans where qqdbs = #{qqdbs} and
        tasktype = #{tasktype}
        and rwlsh= #{rwlsh}
    </select>

    <select id="selectBr40_cxqq_back_trans_dt" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Transaction">
        select A.RWLSH AS RWLSH,A.ZH ZH,A.CXKH as KH,A.ZHMC AS ZHMC,A.BZ as ZHBZ,''
        as
        ZHDYKH,A.JYLX as JYCZ,TO_CHAR(to_date(A.JYSJ,'YYYY-MM-DD HH24:MI:SS'),'YYYYMMDDHH24MISS') as CZSJ,A.JYWDMC as JYDD,B.AJLX as AJLX,A.JE as JYJE,A.BZ as JYBZ,'' as ZHXYED,'' as KHZJLX,'' as
        KHZJHM,JYDFZH as DFZH,JYDFXM as DFZHMC,A.BZ as DFZHBZ,A.JYDFKH as DFZHDYKH,A.PZZL as PZZL,A.PZH as PZH,A.XJBZ as XJBZ,'' as FWJM,'' as ZDH,'' as KYXQ,'' as JYLXYHK,'' as JYLXGJK,'' as SHH,''
        as
        SHMC,A.JYWDMC as WDMS,A.JYWDMC as WDDZ,'' as WDDH,A.JYGYH as GYH,'' as SQGYH,'' as JYDM,'' as FJYBZ,'' as CZJYBS,a.TRANSSEQ
        from br40_cxqq_back_trans a, br40_cxqq b
        where a.qqdbs = b.qqdbs and a.qqdbs
        =
        #{qqdbs} and a.tasktype =#{tasktype} and a.rwlsh= #{rwlsh}
    </select>

    <select id="selectBr40_cxqq_back_trans_dtList" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back" resultType="com.citic.server.jsga.domain.request.JSGA_ControlRequest_Record">
        select case instr(rwlsh, '_', 6) when 0 then rwlsh else substr(rwlsh, 1,
        instr(rwlsh, '_', 6) - 1) end AS RWLSH,
        A.ZH ZH, A.CXKH as KH, A.ZHMC AS ZHMC, A.BZ as ZHBZ,
        '' as ZHDYKH, A.JYLX as JYCZ, A.JYSJ as CZSJ, A.JYWDMC as JYDD, B.AJLX as AJLX, A.JE as JYJE, a.jdbz,A.BZ as
        JYBZ,
        '' as ZHXYED,
        zzlx as KHZJLX, zzhm as KHZJHM, JYDFZH as DFZH, JYDFXM as DFZHMC, A.BZ as DFZHBZ, A.JYDFKH as DFZHDYKH, A.PZZL as PZZL, A.PZH as PZH, A.XJBZ as XJBZ,
        '' as FWJM, a.ZDH as ZDH, '' as
        KYXQ, a.jylx as JYLXYHK, '' as JYLXGJK, a.SHH as SHH, a.SHMC as SHMC,
        A.JYWDMC as WDMS, A.JYWDMC as WDDZ, '' as WDDH, A.JYGYH as GYH, '' as SQGYH, a.JYGYH as JYDM,
        '' as FJYBZ, '' as CZJYBS,
        a.TRANSSEQ
        from br40_cxqq_back_trans a, br40_cxqq b
        where a.qqdbs = b.qqdbs and a.qqdbs = #{qqdbs} and a.tasktype =#{tasktype} and a.rwlsh= #{rwlsh}
    </select>


    <select id="selectBr40_cxqq_backByMaxSeq" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="String">
        select max(to_number(seq)) from br40_cxqq_back where qqdbs = #{qqdbs} and
        tasktype = #{tasktype} and rwlsh= #{rwlsh}
    </select>


    <delete id="delBr40_receipt" parameterType="com.citic.server.jsga.domain.JSGA_ReturnReceipt">
        delete from Br40_receipt where qqdbs=#{qqdbs} and tasktype = #{tasktype}
        <if test="rwlsh != null  and  rwlsh != '' ">
            and rwlsh=#{rwlsh}
        </if>
    </delete>


    <insert id="insertBr40_receipt" parameterType="com.citic.server.jsga.domain.JSGA_ReturnReceipt">
        insert into br40_receipt (tasktype, qqdbs, hzdm, jssj, hzsm, rwlsh)
        values (#{tasktype, jdbcType=VARCHAR}, #{qqdbs, jdbcType=VARCHAR}, #{hzdm,
        jdbcType=VARCHAR}, #{jssj, jdbcType=VARCHAR}, #{hzsm, jdbcType=VARCHAR}, #{rwlsh, jdbcType=VARCHAR})
    </insert>


    <update id="updateBr40_cxqq_back" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back">
        update br40_cxqq_back
        <set>
            <if test="cxfkjg != null  and  cxfkjg != '' ">
                cxfkjg=#{cxfkjg},
            </if>
            <if test="cxjssj != null  and  cxjssj != '' ">
                cxjssj=#{cxjssj},
            </if>
            <if test="czsbyy != null  and  czsbyy != '' ">
                czsbyy=#{czsbyy},
            </if>
            <if test="status != null  and  status != '' ">
                status=#{status}
            </if>
        </set>
        where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh= #{rwlsh}
        <if test="seq != null  and seq != '' ">
            and seq = #{seq}
        </if>
    </update>

    <update id="updateBr40_cxqq_back1" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back">
        update br40_cxqq_back set status=#{status}
        where qqdbs=#{qqdbs} and tasktype = #{tasktype} and (rwlsh= #{rwlsh} or rwlsh in(select a.rwlsh from
        br40_cxqq_mx a where a.yrwlsh=#{rwlsh} ))
        and seq = #{seq}

    </update>

    <update id="updateBr40_cxqq" parameterType="com.citic.server.jsga.domain.Br40_cxqq">
        update br40_cxqq set status=#{status}
        where qqdbs=#{qqdbs} and tasktype = #{tasktype}
    </update>

    <delete id="updateBr40_cxqqStatus" parameterType="com.citic.server.jsga.domain.JSGA_ReturnReceipt">
        update br40_cxqq set
        <choose>
            <when test="hzdm == '30000'.toString()">
                status='3'
            </when>
            <otherwise>
                status='4'
            </otherwise>
        </choose>
        where qqdbs=#{qqdbs} and tasktype = #{tasktype}
    </delete>

    <select id="getBr40_cxqq_backCount" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back" resultType="java.lang.Integer">
        select count(1) from br40_cxqq_back where qqdbs=#{qqdbs} and tasktype =#{tasktype}
        and status in('0','1')
    </select>

    <select id="getBr40_cxqq_mxList" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        select * from Br40_cxqq_mx
        where qqdbs = #{qqdbs} and tasktype = #{tasktype}
        <if test="rwlsh != null  and  rwlsh != '' ">
            and rwlsh= #{rwlsh}
        </if>
    </select>

    <delete id="delBr40_cxqq_hzws" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
  		<![CDATA[ delete from br40_cxqq_hzws where qqdbs=#{qqdbs} and tasktype = #{tasktype} and rwlsh= #{rwlsh}]]>
    </delete>


    <delete id="delBr40_cxqq_acct_dynamic_js" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
	 	 <![CDATA[ delete from Br40_cxqq_acct_dynamic_js where rwlsh=#{rwlsh} and qqdbs=#{qqdbs} and tasktype = #{tasktype} ]]>
    </delete>

    <insert id="insertBr40_cxqq_acct_dynamic_js" parameterType="com.citic.server.jsga.domain.Br40_cxqq">
        insert into br40_cxqq_acct_dynamic_js (qqdbs, rwlsh, cxzh, mxqssj, mxjzsj, status_cd, lastpollingtime, pollinglock, qrydt,
        tasktype)
        values
        (#{qqdbs}, #{rwlsh}, #{cxzh}, #{mxqssj}, #{mxjzsj}, #{status}, #{lastpollingtime}, #{pollinglock}, #{qrydt}, #{tasktype})
    </insert>

    <select id="isPacketCount" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="java.lang.Integer">
        select count(1) from Br40_cxqq_back where qqdbs = #{qqdbs} and tasktype = #{tasktype} and status in
        ('0','1','2')
    </select>
    <select id="isPzPacketCount" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="java.lang.Integer">
        select count(1) from br40_cxqq_back_pz where qqdbs = #{qqdbs} and tasktype = #{tasktype} and
        status in ('0','1','2')
    </select>

    <select id="isTaskCount" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back" resultType="java.lang.Integer">
        select
        case when count(T1.TASKKEY) = sum(case when T2.CALSTATUS = '1' then '1' else '0' end)
        then '0' else '1'
        end as TASKCOUNT
        from MC20_TASK_FACT1 T1
        left join MC20_TASK1_STATUS T2 on T1.TASKKEY =
        T2.TASKKEY
        where
        <choose>
            <when test="tasktype == '8'.toString()">
                substr(T1.BDHM, 13, 22) = #{qqdbs}
            </when>
            <otherwise>
                substr(T1.BDHM, 22, 22) = #{qqdbs}
            </otherwise>
        </choose>
        and T1.TASKTYPE = #{tasktype}
    </select>

    <delete id="delBr42_msg" parameterType="com.citic.server.jsga.domain.Br42_msg">
		<![CDATA[ delete from br42_msg where packetkey=#{packetkey} and bdhm=#{bdhm} and tasktype = #{tasktype} and msg_type_cd= #{msg_type_cd}]]>
    </delete>

    <insert id="insertBr42_msg" parameterType="com.citic.server.jsga.domain.Br42_msg">
        insert into br42_msg (msgkey, bdhm, msg_type_cd, packetkey, organkey_r, senddate, msg_filename, msg_filepath, status_cd, create_dt,tasktype)
        values
        (#{msgkey}, #{bdhm}, #{msg_type_cd}, #{packetkey}, #{organkey_r}, #{senddate}, #{msg_filename}, #{msg_filepath}, #{status_cd}, #{create_dt}, #{tasktype})
    </insert>

    <select id="getBr42_msg" parameterType="com.citic.server.jsga.domain.Br42_packet" resultType="com.citic.server.jsga.domain.Br42_msg">
        select * from Br42_msg where packetkey =#{packetkey} and tasktype = #{tasktype}
        <if test="rwlsh != null  and rwlsh != '' ">
            and bdhm = #{rwlsh}
        </if>
    </select>

    <delete id="delBr42_packet" parameterType="com.citic.server.jsga.domain.Br42_packet">
		<![CDATA[ delete from br42_packet where packetkey=#{packetkey}  and tasktype = #{tasktype}  ]]>
    </delete>

    <insert id="insertBr42_packet" parameterType="com.citic.server.jsga.domain.Br42_packet">
        insert into br42_packet(packetkey,pack_type_cd,organkey_r,senddate_dt,filename,filepath,status_cd,create_dt,tasktype)
        values (#{packetkey},
        #{pack_type_cd}, #{organkey_r}, #{senddate_dt}, #{filename}, #{filepath}, #{status_cd}, #{create_dt}, #{tasktype})
    </insert>

    <select id="getFkkhs" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="java.lang.Integer">
        select count(1) from br40_cxqq_back_party where qqdbs = #{qqdbs} and tasktype =#{tasktype}
    </select>

    <select id="getFkzhs" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="java.lang.Integer">
        select count(1) from Br40_cxqq_back_acct where qqdbs = #{qqdbs} and tasktype =#{tasktype}
    </select>

    <select id="getFkjymxs" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="java.lang.Integer">

        select sum(case when tcount=0 then 1 else tcount end)
        from(
        select a.rwlsh,count(0) as tcount
        from Br40_cxqq_back a left join Br40_cxqq_back_trans b on( a.qqdbs=b.qqdbs and a.rwlsh=b.rwlsh and a.tasktype=b.tasktype)
        where exists(select 'x' from Br40_cxqq_mx c where c.qqdbs=a.qqdbs and c.rwlsh=a.rwlsh
        and c.tasktype=a.tasktype
        and c.cxnr in('02','03'))
        and a.qqdbs = #{qqdbs} and a.tasktype =#{tasktype}
        group by a.rwlsh
        )c
    </select>

    <select id="updateBr40_cxqq_acct_dynamic_js" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        update Br40_cxqq_acct_dynamic_js set status_cd = '0'
        where rwlsh = #{rwlsh}
        <if test="tasktype != null  and tasktype != '' ">
            and tasktype = #{tasktype}
        </if>
    </select>
    <select id="updateBr40_cxqq_acct_dynamic_jc" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        update Br40_cxqq_acct_dynamic_js set status_cd = '0'
        where (rwlsh=#{rwlsh} or rwlsh in(select a.rwlsh from br40_cxqq_mx a where a.yrwlsh=#{rwlsh} ))
        <if test="tasktype != null  and tasktype != '' ">
            and tasktype = #{tasktype}
        </if>

    </select>

    <select id="selBr40_trans_infoList" parameterType="String" resultType="String">
	<![CDATA[ 
		select distinct TRANSSEQ from BR40_CXQQ_BACK_TRANS
		where JYSJ >= #{starttime} and JYSJ <= #{endtime} 
			and TASKTYPE = #{tasktype} 
			and QQDBS = #{qqdbs}
			and RWLSH like #{rwlsh} || '_%' 
		]]>
    </select>

    <select id="getLocalCardInfo" parameterType="String" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Account">
        select
        t1.cardnumber as kh,
        t1.cardnumber as zh,
        t1.status_cd as zhzt,
        t1.open_organkey as khwddm,
        t1.opendate as khrq,
        t1.canceldate
        as xhrq,
        t1.lasttransdt as zhjysj,
        t1.remark as beiz,
        t1.cancel_organkey as xhwddm,
        t1.EXPIRATION_DT as yxq
        from bb11_card t1
        where t1.party_id = #{partyid}
    </select>

    <select id="getLocalCardInfo_byAcctNo" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Account">
        select
        t1.cardnumber as kh,
        t1.cardnumber as zh,
        t1.status_cd as zhzt,
        t1.open_organkey
        as khwddm,
        t1.opendate as khrq,
        t1.canceldate as xhrq,
        t1.lasttransdt as zhjysj,
        t1.remark as beiz,
        t1.cancel_organkey as xhwddm,
        t1.EXPIRATION_DT as yxq
        from bb11_card t1
        where t1.cardnumber=#{cxzh}
    </select>

    <select id="getLocalPublicAcctInfo_byAcctNo" parameterType="String" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Account">
        select
        t1.acct_num as kh,
        t1.acct_num as zh,
        t1.ctac as ctac,
        t1.acct_type as zhlb,
        t1.status_cd as zhzt,
        t1.organkey
        as khwddm,
        t1.oatm as khrq,
        t1.catm as xhrq,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.amtval as kyye,
        t1.last_occur_dt as zhjysj,
        t1.remark as beiz,
        t1.cancel_organkey as xhwddm,
        t1.mature_dt as yxq
        from bb11_deposit_c t1
        where t1.acct_num = #{cxzh}
    </select>

    <select id="getSubAccountList" parameterType="String" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_SubAccount">
        select
        t1.acct_num as zh,
        t1.acct_num as zzhxh,
        t1.type_cd as zzhlb,
        '' as zzhzh,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.status_cd as zhzt,
        t1.amtval as kyye,
        (select
        to_char(sysdate,'yyyy-mm-dd') from dual) as qrydt
        from bb11_id_deposit t1
        where t1.party_id=#{party_id}
        union
        select
        t1.acct_num as
        zh,
        t1.acct_num
        as zzhxh,
        t1.type_cd as zzhlb,
        '' as zzhzh,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.status_cd as
        zhzt,
        t1.amtval as kyye,
        (select to_char(sysdate,'yyyy-mm-dd') from
        dual) as qrydt
        from bb11_deposit_c t1
        where t1.party_id=#{party_id}
    </select>

    <select id="getSubAccountList_byAcctNo" parameterType="String" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_SubAccount">
        select
        t1.acct_num as zh,
        t1.acct_num as zzhxh,
        t1.type_cd as zzhlb,
        '' as zzhzh,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.status_cd as zhzt,
        t1.amtval as kyye,
        (select
        to_char(sysdate,'yyyy-mm-dd') from dual) as qrydt,
        organkey as orgkey
        from bb11_id_deposit t1
        where t1.card_num=#{cxzh}
        union
        select
        t1.acct_num as zh,
        t1.acct_num as zzhxh,
        t1.type_cd as zzhlb,
        '' as zzhzh,
        t1.curr_cd as bz,
        t1.cash_cd as chbz,
        t1.last_amtval as zhye,
        t1.status_cd as
        zhzt,
        t1.amtval as kyye,
        (select
        to_char(sysdate,'yyyy-mm-dd') from dual) as qrydt,
        organkey as orgkey
        from bb11_deposit_c t1
        where t1.acct_num=#{cxzh}
    </select>

    <insert id="insertBr40_cxqq_back_acct_qzcs2" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        insert into br40_cxqq_back_acct_qzcs(
        qqdbs,rwlsh,zh,csxh,djksrq,djjzrq,djjgmc,djje,beiz,djcslx,qrydt,tasktype
        ) values (
        #{qqdbs,jdbcType=VARCHAR},#{rwlsh,jdbcType=VARCHAR},#{zh,jdbcType=VARCHAR},#{csxh,jdbcType=VARCHAR},#{djksrq,jdbcType=VARCHAR},#{djjzrq,jdbcType=VARCHAR},#{djjgmc,jdbcType=VARCHAR},#{djje,jdbcType=VARCHAR},#{beiz,jdbcType=VARCHAR},#{djcslx,jdbcType=VARCHAR},#{qrydt,jdbcType=VARCHAR},#{tasktype,jdbcType=VARCHAR}
        )
    </insert>

    <select id="getBb11_freeze" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.request.JSGA_QueryRequest_Measure">
        select
        t1.acct_num as zh,
        t1.freezeserial as csxh,
        t1.freezestartdate as djksrq,
        t1.freezeenddate
        as djjzrq,
        t1.freezedeptname as djjgmc,
        t1.freezebalance as djje,
        t1.remark as beiz,
        t1.freezetype as djcslx
        from bb11_freeze t1 ,br40_cxqq_back_acct_sub t2
        where t1.acct_num = t2.zh
        and t2.qqdbs=#{qqdbs}
        and t2.rwlsh =#{rwlsh}
        and t2.tasktype = #{tasktype}
    </select>

    <select id="isCardNumCount" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(*) as TASKCOUNT
        from bb11_card
        where cardnumber = #{zh}
    </select>



    <select id="selectBr40_cxqq_mxByOriVo" parameterType="com.citic.server.jsga.domain.Br40_cxqq_mx" resultType="com.citic.server.jsga.domain.Br40_cxqq_mx">
        select
        rwlsh,qqdbs,zzlx,zzhm,cxzh,ztmc,cxnr,mxsdlx,mxqssj,mxjzsj,qrydt,orgkey,tasktype,cxlx,yrwlsh,cxfs,ztlb,xmltype,cxlx
        from br40_cxqq_mx where tasktype = #{tasktype} and rwlsh= #{yrwlsh}
    </select>

    <select id="getBr42_packetbyFileNameCount" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from Br42_packet where filename=#{value}
    </select>

    <delete id="delBr40_cxqq_pz" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
	 	 <![CDATA[ delete from br40_cxqq_back_pz where QQDBS=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>
    <update id="updateBr40_cxqq_pz" parameterType="com.citic.server.jsga.domain.Br40_cxqq">
        update br40_cxqq_back_pz set status=#{status}
        where QQDBS=#{qqdbs} and tasktype = #{tasktype}
        <if test="rwlsh != null  and rwlsh != '' ">
            and rwlsh = #{rwlsh}
        </if>
    </update>


    <delete id="delBr40_cxqq_back_pz_attach" parameterType="com.citic.server.jsga.domain.Br40_cxqq">  
	 	 <![CDATA[ delete from br40_cxqq_back_pz_attach where QQDBS=#{qqdbs} and tasktype = #{tasktype} and rwlsh = #{rwlsh} ]]>
    </delete>

    <update id="updateBr40_cxqq_back_pz_attach" parameterType="com.citic.server.jsga.domain.Br40_cxqq">
        update BR40_CXQQ_BACK_PZ_ATTACH a set xh=(
        select b.xh from(
        select ROW_NUMBER() OVER(PARTITION BY RWLSH,tasktype ORDER BY seq DESC) as xh,qqdbs,rwlsh,tasktype,seq
        from BR40_CXQQ_BACK_PZ_ATTACH
        where QQDBS=#{qqdbs} and tasktype = #{tasktype}
        <if test="rwlsh != null  and rwlsh != '' ">
            and rwlsh = #{rwlsh}
        </if>
        ) b
        where b.qqdbs=a.qqdbs and b.rwlsh=a.rwlsh and b.tasktype=a.tasktype and b.seq=a.seq
        )
        where a.QQDBS=#{qqdbs} and a.tasktype = #{tasktype}
        <if test="rwlsh != null  and rwlsh != '' ">
            and a.rwlsh = #{rwlsh}
        </if>
    </update>

    <select id="selBr40_cxqq_back_pzList" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.request.JSGA_QueryScanRequest_Record">
        select *
        from Br40_cxqq_back_pz
        where QQDBS=#{qqdbs} and tasktype = #{tasktype}
        <if test="rwlsh != null  and rwlsh != '' ">
            and rwlsh = #{rwlsh}
        </if>
    </select>
    <select id="selBr40_cxqq_back_pz5List" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.request.JSGA_QueryScanRequest_Record">
        select t.cxfkjg,t.cxfkjgyy,t.cxzh,t.cxkh,t.cxzl,t.jylsh,t.pztxlx,b.xh as pztxxh,b.filename as pztxmc,t.beiz
        from Br40_cxqq_back_pz t ,BR40_CXQQ_BACK_PZ_ATTACH b
        where t.qqdbs=b.qqdbs and
        t.rwlsh=b.rwlsh and t.tasktype=b.tasktype
        where t.QQDBS=#{qqdbs} and t.tasktype = #{tasktype}
        <if test="rwlsh != null  and rwlsh != '' ">
            and t.rwlsh = #{rwlsh}
        </if>
    </select>

    <select id="selBr40_cxqq_back_pzAttachList" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.Br40_cxqq_back_pz_attach">
        select *
        from br40_cxqq_back_pz_attach
        where QQDBS=#{qqdbs} and tasktype =
        #{tasktype}
    </select>

    <insert id="insertBr40_cxqq_pz" parameterType="com.citic.server.jsga.domain.Br40_cxqq_back_pz">
        insert into br40_cxqq_back_pz(
        rwlsh,qqdbs,cxfkjg,cxfkjgyy,cxzh,cxkh,cxzl,jylsh,pztxlx,beiz,qrydt,orgkey,tasktype,sqjgdm,mbjgdm,ztlb,xmltype,status,cxnr,msgcheckresult
        ) values(
        #{rwlsh,jdbcType=VARCHAR},
        #{qqdbs,jdbcType=VARCHAR},
        #{cxfkjg,jdbcType=VARCHAR},
        #{cxfkjgyy,jdbcType=VARCHAR},
        #{cxzh,jdbcType=VARCHAR},
        #{cxkh,jdbcType=VARCHAR},
        #{cxzl,jdbcType=VARCHAR},
        #{jylsh,jdbcType=VARCHAR},
        #{pztxlx,jdbcType=VARCHAR},
        #{beiz,jdbcType=VARCHAR},
        #{qrydt,jdbcType=VARCHAR},
        #{orgkey,jdbcType=VARCHAR},
        #{tasktype,jdbcType=VARCHAR},
        #{sqjgdm,jdbcType=VARCHAR},
        #{mbjgdm,jdbcType=VARCHAR},
        #{ztlb,jdbcType=VARCHAR},
        #{xmltype,jdbcType=VARCHAR},
        #{status,jdbcType=VARCHAR},
        #{cxnr,jdbcType=VARCHAR} ,
        #{msgcheckresult,jdbcType=VARCHAR}
        )
    </insert>


    <select id="queryBr40_cxqq_back_pz" parameterType="com.citic.server.jsga.domain.Br40_cxqq" resultType="com.citic.server.jsga.domain.Br40_cxqq_back_pz">
        select *
        from Br40_cxqq_back_pz
        where QQDBS=#{qqdbs} and tasktype = #{tasktype}
        and rwlsh = #{rwlsh}
    </select>

</mapper> 